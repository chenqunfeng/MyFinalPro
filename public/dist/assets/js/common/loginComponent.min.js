(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var com, loginBox,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

com = require("./pubComponent.coffee");

loginBox = (function(superClass) {
  extend(loginBox, superClass);

  function loginBox(selector) {
    loginBox.__super__.constructor.call(this, selector);
    this.init();
  }

  loginBox.prototype.init = function() {
    this.render().submitEventBind().loginEventSubscribe().closeEventBind().close();
    return this.loginForm = {
      username: "",
      password: ""
    };
  };

  loginBox.prototype.render = function() {
    loginBox = document.createElement("div");
    loginBox.setAttribute("class", "modelBox normalTransition");
    loginBox.innerHTML = "<div class=\"loginBox borderBox\">\n    <div class='closeBtn'>   \n    </div>\n    <div class=\"borderBox\">\n        <h1 class=\"title\">\n            欢迎使用CQF\n        </h1>\n    </div>\n    <div class=\"borderBox formValidGroup\">\n        <input class=\"username borderBox formValidArea\" \n            name=\"username\" title=\"用户名\" \n            placeholder=\"用户名\" type=\"text\">\n    </div>\n    <div class=\"borderBox formValidGroup\">\n        <input class=\"password borderBox formValidArea\"\n            name=\"password\" title=\"密码\"\n            placeholder=\"密码\" type=\"password\">\n    </div>\n    <div class=\"borderBox\">\n        <button class=\"login transform pointer\" type=\"button\">\n            登陆\n        </button>\n    </div>\n    <div class=\"borderBox\">\n        <hr class=\"lineGrandient\">\n        <a class=\"toRegister pointer\">\n            免费注册→\n        </a>\n    </div>";
    this.contain = loginBox;
    document.getElementsByTagName("body")[0].appendChild(loginBox);
    return this;
  };

  loginBox.prototype.loginRequest = function() {
    var form;
    form = {
      username: this.loginForm.username.value,
      password: this.loginForm.password.value
    };
    return $.ajax({
      type: "post",
      url: "/user/login",
      dataType: "json",
      data: form,
      success: (function(_this) {
        return function(data) {
          var msg, status;
          console.log(data);
          status = data.status;
          msg = data.msg;
          if ("success" === status) {
            return _this.publish("loginBox.login.success");
          } else if ("failed" === status) {
            return _this.publish("loginBox.login.failed", msg);
          }
        };
      })(this),
      error: (function(_this) {
        return function(err) {
          _this.publish("loginBox.login.failed");
          return console.log(err);
        };
      })(this)
    });
  };

  loginBox.prototype.submitEventBind = function() {
    var submit;
    submit = $(".loginBox .login");
    $(submit).on("click", (function(_this) {
      return function() {
        if (_this.validLoginValue()) {
          return _this.loginRequest();
        }
      };
    })(this));
    return this;
  };

  loginBox.prototype.loginEventSubscribe = function() {
    this.subscribe("loginBox.login.success", (function(_this) {
      return function() {
        return location.href = "/game";
      };
    })(this));
    this.subscribe("loginBox.login.failed", (function(_this) {
      return function(publisher, type, msg) {
        var err, p, u;
        u = "";
        p = "";
        if (RegExp("username").test(msg)) {
          u = "账号不存在！";
        }
        if (RegExp("password").test(msg)) {
          p = "密码错误！";
        }
        err = {
          username: u,
          password: p
        };
        return _this.styleValid(err);
      };
    })(this));
    return this;
  };

  loginBox.prototype.validLoginValue = function() {
    this.styleValid();
    return this.dataValid();
  };

  loginBox.prototype.styleValid = function(err) {
    var all;
    all = $(".loginBox .formValidArea");
    all.map((function(_this) {
      return function(i, input) {
        var n, r;
        n = input.getAttribute("name");
        if (err) {
          r = _this[n](input, err[n]);
        } else {
          r = _this[n](input);
        }
        return _this.loginForm[n] = r;
      };
    })(this));
    return this;
  };

  loginBox.prototype.dataValid = function() {
    var p, u;
    u = this.loginForm.username.result;
    p = this.loginForm.password.result;
    return u && p;
  };

  loginBox.prototype.username = function(t, err) {
    var mes, r, v;
    v = $(t).val();
    if (!v) {
      r = false;
      mes = "帐号不能为空!!!";
    } else if (v) {
      r = true;
      mes = "";
      if (err) {
        mes = err;
      }
    }
    t.parentNode.setAttribute("data-attr", mes);
    return {
      result: r,
      msg: mes,
      value: v
    };
  };

  loginBox.prototype.password = function(t, err) {
    var mes, r, v;
    v = $(t).val();
    if (!v) {
      r = false;
      mes = "密码不能为空!!!";
    } else if (v) {
      r = true;
      mes = "";
      if (err) {
        mes = err;
      }
    }
    t.parentNode.setAttribute("data-attr", mes);
    return {
      result: r,
      msg: mes,
      value: v
    };
  };

  loginBox.prototype.closeEventBind = function() {
    var close;
    close = $(".loginBox .closeBtn");
    $(close).on("click", (function(_this) {
      return function() {
        return _this.close();
      };
    })(this));
    return this;
  };

  loginBox.prototype.close = function() {
    this.addClass(this.contain, "fadeOut");
    this.removeClass(this.contain, "fadeIn");
    return this.publish("loginBox.close");
  };

  loginBox.prototype.open = function() {
    this.addClass(this.contain, "fadeIn");
    this.removeClass(this.contain, "fadeOut");
    return this.publish("loginBox.open");
  };

  loginBox.prototype.eventBind = function() {
    return $(document).on("click", ".toLogin", (function(_this) {
      return function() {
        return _this.close();
      };
    })(this));
  };

  return loginBox;

})(com.Components);

module.exports = loginBox;


},{"./pubComponent.coffee":2}],2:[function(require,module,exports){
var Components, Events,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Events = (function() {
  function Events() {
    this.subscription = {};
  }

  Events.prototype.subscribe = function(type, fn, cons) {
    var f, id, p, r;
    if ("undefined" === typeof this.subscription.eventmap) {
      this.subscription.eventmap = {};
    }
    if ("undefined" === typeof this.subscription[type]) {
      this.subscription[type] = [];
    }
    p = this.subscription[type];
    r = false;
    if (p.length > 0) {
      f = fn.toString();
      r = !this.each.call(p, function(item) {
        if (item && f === item.response.toString() && cons && cons === item.caller) {
          return false;
        }
      });
    }
    if (false === r) {
      id = Math.floor(Math.random() * 1000000000000000).toString(36);
      this.subscription.eventmap[id] = type;
      p.push({
        "id": id,
        "response": fn,
        "caller": cons
      });
    }
    return id;
  };

  Events.prototype.publish = function(type) {
    var p, params, publisher;
    p = this.subscription[type];
    if (p && p.length) {
      params = arguments.length > 0 ? Array.prototype.slice.call(arguments) : [];
      publisher = this;
      params.unshift(publisher);
      this.each.call(p, function(item) {
        var cons;
        if (item) {
          cons = item.caller || null;
          return item.response.apply(cons, params);
        }
      });
    }
    return this;
  };

  Events.prototype.unsubscribe = function(id, handle) {
    var map, p, type;
    if ("string" === typeof id) {
      if ("type" === handle) {
        this.subscription[type] && (this.subscription[type].length = 0);
      } else {
        map = this.subscription.eventmap;
        type = map[id];
        if (type) {
          p = this.subscription[type];
          if (p && p.length > 0) {
            this.each.call(p, function(item, index) {
              if (item && id === item.id) {
                p[index] = null;
                map[id] = null;
                delete map[id];
                return false;
              }
            });
          }
        }
      }
    } else {
      this.subscription = {};
    }
    return this;
  };

  Events.prototype.each = function(fn) {
    var i, index, item, key, len, len1, params, result;
    len = this.length;
    params = arguments.length > 1 ? Array.prototype.slice.call(arguments) : [];
    params.length > 1 && params.shift();
    if (len) {
      for (index = i = 0, len1 = this.length; i < len1; index = ++i) {
        item = this[index];
        result = fn.apply(this, [item, index].concat(params));
        if (result === false) {
          return false;
        }
      }
    } else {
      for (key in this) {
        item = this[key];
        if (this.hasOwnProperty(key)) {
          result = fn.apply(this, [item, key].concat(params));
          if (result === false) {
            return false;
          }
        }
      }
    }
    return true;
  };

  return Events;

})();

Components = (function(superClass) {
  extend(Components, superClass);

  function Components(selector) {
    var node;
    Components.__super__.constructor.call(this);
    this.contain = null;
    if ("string" === typeof selector) {
      node = document.querySelector(selector);
    } else if ("object" === typeof selector && selector.nodeType && 1 === selector.nodeType) {
      node = selector;
    }
    if (node && node.getAttribute) {
      this.contain = node;
    }
    this.subscribe("render", this.init, this);
  }

  Components.prototype.render = function(fn) {
    fn.call(this);
    return this.publish("render");
  };

  Components.prototype.init = function() {};

  Components.prototype.contains = function(parent, child) {
    if (parent === child) {
      return 0;
    }
    if (parent.contains) {
      if (parent.contains(child)) {
        return 1;
      }
    } else {
      if (!!(parent.compareDocumentPosition(child) & 16)) {
        return 1;
      }
    }
    return -1;
  };

  Components.prototype.upperStyleName = function(s) {
    return s && s.length && s.replace(/-([a-z])/g, function(a, b) {
      return b.toUpperCase();
    }) || '';
  };

  Components.prototype.lowerStyleName = function(s) {
    return s && s.length && s.replace(/([A-Z])/g, function(a, b) {
      return '-' + b.toLowerCase();
    }) || '';
  };

  Components.prototype.addClass = function(node, className) {
    if (node && node.getAttribute) {
      if (!this.hasClass(node, className)) {
        node.className += " " + className;
      }
    }
    return this;
  };

  Components.prototype.removeClass = function(node, className) {
    var oldClass, reg;
    if (node && node.getAttribute) {
      if (this.hasClass(node, className)) {
        oldClass = node.className;
        reg = new RegExp("(^|\\s)" + className + "(\\s|$)");
        node.className = oldClass.replace(reg, " ").replace(/(^\s+|\s+$)/g, "");
      }
    }
    return this;
  };

  Components.prototype.hasClass = function(node, className) {
    var reg;
    if (node && node.getAttribute) {
      reg = new RegExp("(^|\\s)" + className + "(\\s|$)");
      return node.className && reg.test(node.className);
    }
    return false;
  };

  return Components;

})(Events);

module.exports = {
  Events: Events,
  Components: Components
};


},{}]},{},[1])